<div class="container">
  <ng-container *ngIf="ifTarget">
    <p class="title">Update your group</p>
  </ng-container>
  <ng-container *ngIf="!ifTarget">
    <p class="title">Create your group</p>
  </ng-container>

  <button
    mat-raised-button
    class="userMyOwnImage-button"
    (click)="switchUseMyOwnImage()"
    color="primary"
  >
    <ng-container *ngIf="useMyOwnImage">
      Choose from templates
    </ng-container>
    <ng-container *ngIf="!useMyOwnImage">
      Choose from library
    </ng-container>
  </button>

  <div *ngIf="!useMyOwnImage">
    <div class="swiper">
      <swiper [config]="config" [(index)]="selectedImageId">
        <div *ngFor="let imageId of imageIds">
          <img
            class="background-image"
            alt="group image"
            src="/assets/background/{{ imageId }}.jpg"
          />
        </div>
      </swiper>
      <div class="pager"></div>
    </div>
  </div>

  <div class="select-image-container" *ngIf="useMyOwnImage">
    <mat-form-field
      class="image-selector"
      appearance="outline"
      class="file-field"
    >
      <mat-label>Select an image</mat-label>
      <ngx-mat-file-input
        placeholder="Basic outline placeholder"
        (change)="fileChangeEvent($event)"
      >
      </ngx-mat-file-input>
      <mat-icon matSuffix>folder</mat-icon>
    </mat-form-field>

    <div class="cropper-container" *ngIf="imageChangedEvent">
      <img class="selected-image" [src]="croppedImage" />

      <image-cropper
        [imageChangedEvent]="imageChangedEvent"
        [maintainAspectRatio]="true"
        [aspectRatio]="8 / 3"
        [roundCropper]="false"
        format="png"
        (imageCropped)="imageCropped($event)"
        (imageLoaded)="imageLoaded()"
        (cropperReady)="cropperReady()"
        (loadImageFailed)="loadImageFailed()"
      ></image-cropper>
    </div>
  </div>

  <form [formGroup]="form" class="form">
    <mat-form-field appearance="outline" class="field">
      <mat-label>Name your group</mat-label>
      <input matInput formControlName="name" type="email" required />
    </mat-form-field>

    <mat-form-field appearance="outline" class="field">
      <mat-label>Write group description or additional info</mat-label>
      <textarea matInput formControlName="description" type="text"></textarea>
    </mat-form-field>

    <p>Is there a limit for number of members?</p>
    <mat-radio-group
      [(ngModel)]="ifMemberLimit"
      [ngModelOptions]="{ standalone: true }"
    >
      <mat-radio-button class="radio-button" [value]="true"
        >Yes</mat-radio-button
      >
      <mat-radio-button [value]="false">No</mat-radio-button>
    </mat-radio-group>

    <mat-form-field *ngIf="ifMemberLimit" appearance="outline" class="field">
      <mat-label>What is the limit?</mat-label>
      <input
        matInput
        formControlName="memberlimit"
        placeholder="E.g. 0"
        type="number"
      />
    </mat-form-field>

    <p>Choose the payment model</p>
    <mat-radio-group
      aria-label="Select an option"
      [(ngModel)]="ifSubscription"
      [ngModelOptions]="{ standalone: true }"
    >
      <mat-radio-button class="radio-button" [value]="true"
        >Pay monthly</mat-radio-button
      >
      <mat-radio-button [value]="false">Pay once</mat-radio-button>
    </mat-radio-group>

    <ng-container *ngIf="form.value.price !== 0">
      <p>
        Price: {{ form.value.price }} {{ form.value.currency
        }}<span *ngIf="ifSubscription">/month</span>
      </p>
    </ng-container>

    <mat-form-field class="field">
      <mat-label>Choose currency</mat-label>
      <mat-select formControlName="currency">
        <div *ngFor="let currency of currencies">
          <mat-option [value]="currency">{{ currency }}</mat-option>
        </div>
      </mat-select>
    </mat-form-field>

    <mat-slider
      thumbLabel
      class="field"
      [displayWith]="formatLabel"
      tickInterval="1000"
      step="500"
      formControlName="price"
      min="0"
      max="50000"
    ></mat-slider>

    <mat-slide-toggle formControlName="private" class="toggle">
      <ng-container *ngIf="form.value.private">
        Private
      </ng-container>
      <ng-container *ngIf="!form.value.private">
        Public
      </ng-container>
    </mat-slide-toggle>

    <mat-slide-toggle formControlName="searchable" class="toggle">
      <ng-container *ngIf="form.value.searchable">
        Searchable
      </ng-container>
      <ng-container *ngIf="!form.value.searchable">
        Unsearchable
      </ng-container>
    </mat-slide-toggle>

    <div *ngIf="ifTarget">
      <button
        mat-raised-button
        class="submit-button"
        [disabled]="form.invalid"
        color="primary"
        (click)="update()"
      >
        Update
      </button>
      <button
        mat-raised-button
        class="submit-button"
        [disabled]="form.invalid"
        color="warn"
        (click)="delete()"
      >
        Delete
      </button>
    </div>

    <ng-container *ngIf="!ifTarget">
      <button
        mat-raised-button
        class="submit-button"
        [disabled]="form.invalid || form.pristine"
        color="primary"
        (click)="submit()"
      >
        Create
      </button>
    </ng-container>
  </form>
</div>
