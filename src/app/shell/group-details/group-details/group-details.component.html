<div *ngIf="!group" class="container">
  <img
    class="no-group-image"
    src="/assets/images/404.svg"
    alt="group does not exist"
  />
</div>

<div *ngIf="group">
  <mat-toolbar>
    <button mat-icon-button color="primary" (click)="navigateBack()">
      <mat-icon>arrow_back</mat-icon>
    </button>

    <div *ngIf="ifadmin">
      <a routerLink="/create-group" [queryParams]="{ id: id }">
        <button mat-icon-button color="primary">
          <mat-icon>edit</mat-icon>
        </button>
      </a>
    </div>
  </mat-toolbar>

  <img class="group-picture" src="{{ group?.grouppicture }}" />

  <div>
    <p>{{ group?.name }}</p>

    <p>{{ group?.description }}</p>

    <div *ngIf="group?.private">
      <p>This is private group</p>
    </div>
    <div *ngIf="!group?.private">
      <p>This is public group</p>
    </div>

    <p>
      Created by
      <span routerLink="/account" [queryParams]="{ id: creater?.searchId }">
        {{ creater?.displayName }}
      </span>
      on
      {{ group?.createddate.toDate() | date: 'yyyy/MM/dd' }}
    </p>

    <div *ngIf="group?.price === 0">
      <p>Price: {{ group?.price }}</p>
    </div>
    <div *ngIf="group?.price !== 0">
      <p>Price: {{ group?.price }} {{ group?.currency }}</p>
    </div>

    <div *ngIf="admins?.length">
      <p>Admins</p>
      <ul>
        <div *ngFor="let admin of admins">
          <li>
            <span routerLink="/account" [queryParams]="{ id: admin.searchId }">
              {{ admin.displayName }}
            </span>
            <button
              mat-button
              *ngIf="ifadmin && admin.uid === uid"
              color="warn"
              (click)="deleteAdmin(admin.uid)"
            >
              Unauthorize
            </button>
          </li>
        </div>
      </ul>
    </div>

    <div *ngIf="members?.length">
      <p>Members</p>
      <ul>
        <div *ngFor="let member of members">
          <li>
            <p routerLink="/account" [queryParams]="{ id: member.searchId }">
              {{ member.displayName }}
            </p>
            <div
              *ngIf="
                ifadmin && member.uid !== uid && !adminIds.includes(member.uid)
              "
            >
              <button
                mat-button
                color="primary"
                (click)="makeAdmin(member.uid)"
              >
                Authorize as an admin
              </button>
              <button mat-button color="warn" (click)="leaveGroup(member.uid)">
                Kick out
              </button>
            </div>
          </li>
        </div>
      </ul>
    </div>

    <div *ngIf="!members?.length">
      <p>There is no members.</p>
    </div>

    <div *ngIf="(waitingJoinningMembers | async)?.length">
      <p>Waiting users</p>
      <ul>
        <div *ngFor="let waitingMember of waitingJoinningMembers | async">
          <li>
            <span
              routerLink="/account"
              [queryParams]="{ searchId: waitingMember.searchId }"
            >
              {{ waitingMember.displayName }}
            </span>
            <div *ngIf="ifadmin">
              <!-- 無料グループの場合 -->
              <div *ngIf="group?.price === 0">
                <div>
                  <button
                    mat-button
                    color="primary"
                    (click)="allowWaitingMember(waitingMember.uid)"
                  >
                    Allow
                  </button>
                </div>
                <div class="remove-button">
                  <button
                    mat-button
                    color="warn"
                    (click)="leaveWaitingList(waitingMember.uid)"
                  >
                    Remove
                  </button>
                </div>
              </div>
              <!-- 有料グループの場合 -->
              <div *ngIf="group?.price !== 0">
                <div>
                  <button
                    mat-button
                    color="primary"
                    (click)="
                      waitingJoinningMemberToWaitingPayingMember(
                        waitingMember.uid
                      )
                    "
                  >
                    Allow
                  </button>
                </div>

                <div>
                  <button
                    mat-button
                    color="warn"
                    (click)="leaveWaitingList(waitingMember.uid)"
                  >
                    Remove
                  </button>
                </div>
              </div>
            </div>
          </li>
        </div>
      </ul>
    </div>

    <div *ngIf="!(waitingJoinningMembers | async)?.length">
      <p>There is no waiting member.</p>
    </div>

    <p>Inviting list</p>

    <div *ngIf="invitingUsers?.length">
      <ul>
        <div *ngFor="let invitingUser of invitingUsers">
          <li>
            <span
              routerLink="/account"
              [queryParams]="{ id: invitingUser.searchId }"
            >
              {{ invitingUser.displayName }}
            </span>
            <button mat-button>
              Remove
            </button>
          </li>
        </div>
      </ul>
    </div>

    <div class="actions">
      <button mat-raised-button color="primary" (click)="openDialog()">
        Invite people
      </button>

      <button mat-raised-button routerLink="/" color="primary">
        Check events
      </button>

      <div *ngIf="ifmember">
        <div *ngIf="!group?.chatRoomId && ifadmin">
          <button mat-raised-button (click)="createChatRoom()" color="primary">
            Create chat room
          </button>
        </div>
        <div *ngIf="group?.chatRoomId">
          <button
            mat-raised-button
            routerLink="/chat/chat-detail"
            [queryParams]="{ id: group?.chatRoomId }"
            color="primary"
          >
            Go to chat room
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
