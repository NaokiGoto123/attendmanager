<div class="container">
  <mat-nav-list
    class="nav-list"
    dense
    *ngIf="customerService.customer$ | async as customer"
  >
    <h3 matSubheader>Cards</h3>
    <mat-list-item *ngIf="loading">読み込み中...</mat-list-item>
    <mat-list-item *ngIf="methods && !methods.length" disabled
      >カードはありません</mat-list-item
    >
    <mat-list-item
      *ngFor="let method of methods"
      (click)="setCardToForm(method)"
    >
      <span matLine
        >**** **** **** {{ method.card.last4 }} / {{ method.card.brand }}</span
      >
      <span matLine *ngIf="customer.defaultPaymentMethod === method.id"
        >デフォルト</span
      >
      <button
        mat-icon-button
        [matMenuTriggerFor]="menuRef"
        *ngIf="customer.defaultPaymentMethod !== method.id"
      >
        <mat-icon>more_vert</mat-icon>
      </button>
      <mat-menu #menuRef="matMenu">
        <button
          mat-menu-item
          (click)="paymentService.setDefaultMethod(method.id)"
        >
          <mat-icon>credit_card</mat-icon>
          <span>デフォルトに設定する</span>
        </button>
        <button mat-menu-item (click)="deleteStripePaymentMethod(method.id)">
          <mat-icon>delete</mat-icon>
          <span>削除</span>
        </button>
      </mat-menu>
    </mat-list-item>
  </mat-nav-list>

  <div class="form-container">
    <form class="form" [formGroup]="form" (ngSubmit)="createCard()">
      <mat-form-field class="form__field">
        <mat-label>名前</mat-label>
        <input
          type="text"
          matInput
          required
          formControlName="name"
          autocomplete="name"
        />
      </mat-form-field>

      <mat-form-field class="form__field">
        <mat-label>メール</mat-label>
        <input
          type="email"
          matInput
          required
          formControlName="email"
          autocomplete="email"
        />
      </mat-form-field>

      <div class="card-element" #cardElement></div>

      <button
        mat-raised-button
        color="primary"
        [disabled]="form.invalid || form.pristine || !isComplete || loading"
      >
        保存
      </button>
    </form>
  </div>
</div>
